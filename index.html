<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Mur Digital â€“ #OrangerLaRDC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --blue-un: #448BCA;
      --orange: #F58220;
      --bg-dark: #020617;
      --card: #020617;
      --text-main: #f9fafb;
      --muted: #9ca3af;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 16px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, var(--blue-un), var(--bg-dark));
      color: var(--text-main);
    }

    header {
      text-align: center;
      margin-bottom: 24px;
    }

    header h1 {
      margin: 0;
      font-size: 1.9rem;
      text-transform: uppercase;
      letter-spacing: .08em;
      color: var(--orange);
    }

    header p {
      margin: 6px 0 0;
      font-size: .95rem;
      color: var(--text-main);
    }

    header span {
      display: inline-block;
      margin-top: 4px;
      font-size: .85rem;
      color: var(--muted);
    }

    .toolbar {
      max-width: 960px;
      margin: 0 auto 16px;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 8px;
      font-size: .85rem;
      color: var(--muted);
      align-items: center;
    }

    .toolbar button {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      background: rgba(15,23,42,.9);
      color: var(--text-main);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: .8rem;
      box-shadow: 0 10px 25px rgba(0,0,0,.4);
      border: 1px solid rgba(148,163,184,.4);
    }

    .toolbar button:hover {
      background: rgba(15,23,42,1);
      transform: translateY(-1px);
    }

    .grid {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
      gap: 16px;
    }

    .card {
      background: linear-gradient(135deg, rgba(15,23,42,.95), rgba(15,23,42,.85));
      border-radius: 18px;
      padding: 10px;
      text-align: center;
      box-shadow: 0 14px 30px rgba(0,0,0,.5);
      border: 1px solid rgba(148,163,184,.3);
      backdrop-filter: blur(12px);
    }

    .card img {
      max-width: 100%;
      border-radius: 14px;
      display: block;
      margin: 0 auto 8px;
    }

    .province {
      font-size: .8rem;
      color: var(--muted);
      margin-top: 2px;
    }

    .sticker-labels {
      font-size: .8rem;
      color: var(--orange);
      margin-top: 4px;
      font-weight: 600;
    }

    .summary {
      max-width: 960px;
      margin: 16px auto 0;
      font-size: .8rem;
      color: var(--muted);
    }

    .summary strong {
      color: var(--orange);
    }

    @media (max-width: 600px) {
      header h1 {
        font-size: 1.4rem;
      }
      .toolbar {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Mur Digital â€“ #OrangerLaRDC</h1>
    <p>Visuels dâ€™engagement collectÃ©s via la campagne digitale</p>
    <span>Les vignettes se mettent Ã  jour automatiquement Ã  partir des rÃ©ponses KoboToolbox.</span>
  </header>

  <div class="toolbar">
    <div id="summaryCounts">Chargement des donnÃ©esâ€¦</div>
    <button type="button" onclick="refreshWall()">
      ðŸ”„ Actualiser les visuels
    </button>
  </div>

  <div id="wall" class="grid"></div>

  <div class="summary">
    <p>
      âœ… <strong>Note :</strong> ce mur digital affiche les engagements soumis via votre formulaire Kobo
      (stickers + province). Pour respecter la confidentialitÃ©, adaptez la structure si vous ajoutez
      des donnÃ©es personnelles.
    </p>
  </div>

  <script>
    // âš ï¸ IMPORTANT :
    // Pour un vrai site public de production, il est dÃ©conseillÃ© de laisser le token Kobo ici.
    // IdÃ©alement, il faut passer par un petit backend (proxy) qui cache le token cÃ´tÃ© serveur.
    // Ici, on garde la version simple pour un mur digital hÃ©bergÃ© sur GitHub Pages / dÃ©mo.

    // Endpoint de donnÃ©es Kobo (API v2) pour ton formulaire
    const KOBO_URL = "https://kf.kobotoolbox.org/api/v2/assets/aQL229knhzDHyFjHkrJKax/data/";
    // ðŸ‘‰ Remplace VOTRE_TOKEN_KOBO_ICI par ton vrai token Kobo
    const KOBO_TOKEN = "06a5656556501c12cc08d9aa69b2be9c78a8da85";

    // Mapping des codes de sÃ©lection multiple -> fichiers image
    // Ces images doivent exister dans ton dÃ©pÃ´t dans le dossier "images/"
    // ex : images/Jemengage.png, images/NonViolence.png, images/PasExcuse.png
    const STICKER_IMAGES = {
      "jemengage": "images/Jemengage.png",
      "nonviolences": "images/NonViolence.png",
      "pasdexcuse": "images/PasExcuse.png"
    };

    function humanStickerLabel(code) {
      switch (code) {
        case "jemengage":
          return "#Jem'engage";
        case "nonviolences":
          return "#NonViolences";
        case "pasdexcuse":
          return "#PasD'Excuse";
        default:
          return code;
      }
    }

    async function fetchKoboData() {
      const res = await fetch(KOBO_URL, {
        headers: {
          "Authorization": "Token " + KOBO_TOKEN
        }
      });
      if (!res.ok) {
        console.error("Erreur API Kobo:", res.status, await res.text());
        throw new Error("Erreur de rÃ©cupÃ©ration des donnÃ©es Kobo");
      }
      const data = await res.json();
      return data.results || [];
    }

    function renderWall(submissions) {
      const wall = document.getElementById("wall");
      const summary = document.getElementById("summaryCounts");
      wall.innerHTML = "";

      let totalTiles = 0;
      const provincesCount = {};

      submissions.forEach(row => {
        // 'stickers' = select_multiple => ex: "jemengage nonviolences"
        const stickers = (row.stickers || "").trim().split(" ").filter(Boolean);
        const province = row.province || "Province inconnue";

        if (!provincesCount[province]) provincesCount[province] = 0;

        stickers.forEach(s => {
          const imgSrc = STICKER_IMAGES[s];
          if (!imgSrc) return; // ignore stickers inconnus

          totalTiles++;
          provincesCount[province] += 1;

          const card = document.createElement("div");
          card.className = "card";

          const img = document.createElement("img");
          img.src = imgSrc;
          img.alt = humanStickerLabel(s);

          const stickLbl = document.createElement("div");
          stickLbl.className = "sticker-labels";
          stickLbl.textContent = humanStickerLabel(s);

          const prov = document.createElement("div");
          prov.className = "province";
          prov.textContent = province;

          card.appendChild(img);
          card.appendChild(stickLbl);
          card.appendChild(prov);
          wall.appendChild(card);
        });
      });

      const provincesList = Object.keys(provincesCount);
      summary.textContent = `ðŸ§© ${totalTiles} visuels affichÃ©s Â· ðŸŒ ${provincesList.length} provinces reprÃ©sentÃ©es`;
    }

    async function refreshWall() {
      const summary = document.getElementById("summaryCounts");
      summary.textContent = "â³ Actualisation en coursâ€¦";
      try {
        const rows = await fetchKoboData();
        renderWall(rows);
      } catch (e) {
        console.error(e);
        summary.textContent = "âš ï¸ Erreur lors du chargement des donnÃ©es Kobo";
      }
    }

    // Chargement initial
    (async () => {
      await refreshWall();
      // Option : activer un rafraÃ®chissement automatique toutes les 60 secondes :
      // setInterval(refreshWall, 60000);
    })();
  </script>
</body>
</html>
